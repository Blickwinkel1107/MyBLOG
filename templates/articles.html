<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <!--Markdown Editor-->
    <link rel="stylesheet" href="static/editor.md-master/css/editormd.css" />
    <!--Boostrap组件引入-->
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--Echarts-->
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
    <title>Articles</title>
</head>
<body>
<!--导航栏-->
<nav class="navbar navbar-inverse" role="navigation" style="margin-bottom: 50px; border-radius: 0">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-send"></span>  Navigator</a>
        </div>
        <div>
            <!--向左对齐-->
            <ul class="nav navbar-nav navbar-left">
                <!--普通选项卡-->
                <li><a href="index"><span class="glyphicon glyphicon-home"></span>  Index</a></li>
                <li class="active"><a href="articles"><span class="glyphicon glyphicon-book"></span>  Articles</a></li>
                <!--下拉式菜单-->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span class="glyphicon glyphicon-link"></span>
                        Database
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">文章数据库</a></li>
                        <li><a href="#">用户信息数据库</a></li>
                        <li class="divider"></li>
                        <li><a href="#">网页源码</a></li>
                        <li class="divider"></li>
                        <li><a href="admin">Django后台</a></li>
                    </ul>
                </li>
            </ul>
            <!--向右对齐-->
            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated %}
                <li class="navbar-text">{{ user.username }}，欢迎您！</li>
                <li><a href="{% url 'logout' %}?next={{ request.path }}">
                    <span class="glyphicon glyphicon-user"></span> Logout</a></li>
                {% else %}
                <li><a href="{% url 'users:register' %}?next={{ request.path }}">
                    <span class="glyphicon glyphicon-user"></span> Register</a></li>
                <li><a href="{% url 'login' %}?next={{ request.path }}">
                    <span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
<!--引入-->
<div class="container">
    <!--Art1-->
    <div class="row">
        <div class="col-sm-1">
        </div>
        <div class="col-sm-8 well well-lg jumbotron">
            <h1>岳翔的网站</h1>
            <small>本行内容是在标签内</small><br>
            <strong>本行内容是在标签内</strong><br>
            <em>本行内容是在标签内，并呈现为斜体</em><br>
            <p class="text-left">向左对齐文本向左对齐文本向左对齐文本向左对齐文本向左对齐文本向左对齐文本</p>
            <p class="text-center">居中对齐文本</p>
            <p class="text-right">向右对齐文本</p>
            <p class="text-muted">本行内容是减弱的</p>
            <p class="text-primary">本行内容带有一个 primary class</p>
            <p class="text-success">本行内容带有一个 success class</p>
            <p class="text-info">本行内容带有一个 info class</p>
            <p class="text-warning">本行内容带有一个 warning class</p>
            <p class="text-danger">本行内容带有一个 danger class</p>
        </div>
        <!--第二列-->
        <div class="col-sm-2 well">
            <h1>侧边栏</h1>
            <p class="text-left">This is a string of testing text, here's a reminder,
                fuck you motherfucker!<br />
                ThisIsATesting, TextThisIsATesting, TextThisIsATestingT, extThisIsATestingText<br />
                ThisIsATesting, TextThisIsATesting, TextThisIsATestingTe, xtThisIsATestingText</p>
        </div>
        <div class="col-sm-1">

        </div>
    </div>
    <!--Art2-->
    <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-8 well well-lg" >
            <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
            <div id="main" style="width: available; height:400px;"></div>
            <script type="text/javascript" src="static/js/plot1.js"></script>
        </div>
        <div class="col-sm-3"></div>
    </div>
    <!--循环渲染博文-->
    {% for article in articles %}
    <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-8 well well-lg">
            {% autoescape off %}
                {{ article.1 }}
            {% endautoescape %}
        </div>
        <div class="col-sm-3"></div>
    </div>
    {% endfor %}
    {% if user.is_authenticated %}
    <button class="btn btn-primary" onclick="showMdEditor()" style="margin-bottom: 30px">显示编辑器</button>
    <div class="row" style="display: none;" id="mdeditor">
        <div class="col-sm-12 well">
            <div id="test-editormd">
                <textarea style="display:none;"></textarea>
            </div>
        </div>
        <button type="submit" class="btn btn-primary" onclick="getMdHTML()" style="margin-top: 30px">提交</button>
    </div>
    {% endif %}
</div>


<!--底部copyright-->
<footer class="footer">
    <div class="container" style="margin-top: 50px">
        <div class="row">
            <div class="col-sm-1"></div>
            <div class="col-sm-10">
                <p class="text-center">Copyright © 2018 Blickwinkel All Rights Reserved.</p>
            </div>
            <div class="col-sm-1"></div>
        </div>
    </div>
</footer>
<!--mdeditor-->
    <link rel="stylesheet" href="static/editor.md-master/css/editormd.preview.css" />
    <script src="static/editor.md-master/examples/js/jquery.min.js"></script>
    <script src="static/editor.md-master/editormd.js"></script>
<script type="text/javascript">
    let editer;
    function showMdEditor(){
        let opened = document.getElementById('mdeditor').style.display;
        if(opened === 'none'){
            document.getElementById('mdeditor').style.display = 'block';
            editer = editormd("test-editormd", {
                width   : "100%",
                height  : 640,
                syncScrolling : "both",
                //你的lib目录的路径，我这边用JSP做测试的
                path    : "static/editor.md-master/lib/",
                //这个配置在simple.html中并没有，但是为了能够提交表单，使用这个配置可以让构造出来的HTML代码直接在第二个隐藏的textarea域中，方便post提交表单。
                saveHTMLToTextarea : true
            });
        }
        else{
            document.getElementById('mdeditor').style.display = 'none';
            delete editormd("test-editormd");
        }
    }
    function getMdHTML(){
        let str_html = editer.getHTML();
        console.log(str_html);
        $.ajax({
            url: 'articles',
            type: 'POST',
            datatype: 'json',
            data: {
                'mdHTML': str_html,
            },
            success: function () {
                alert('博文发表成功！');
                window.location.reload();
            },
            error: function(){
                alert('失败~');
            }
        })
    }
</script>
</body>
</html>